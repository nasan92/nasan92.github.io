<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>(1/2) Setting up Azure workload identity federation with Terraform in Azure DevOps pipelines (2 Part Series) - NASAN</title><meta name=Description content><meta property="og:title" content="(1/2) Setting up Azure workload identity federation with Terraform in Azure DevOps pipelines (2 Part Series)"><meta property="og:description" content="I was curious about how to set up Azure DevOps to utilize Terraform for deploying Azure resources with workload identity federation instead of relying on a service principal with secrets. In this blog post, I will demonstrate how I set up this configuration.
To learn more about workload identity federation read the docs:
Workload identity federation - Microsoft Entra | Microsoft Learn
Prerequisites Azure DevOps Org &ldquo;Customer Azure Tenant&rdquo; with Subscription &ldquo;Backend Azure Tenant&rdquo; with Subscription (can be in the same tenant - in our example we use different tenants) Azure Powershell Module Overview - Setup Steps Create a storage account that will store the Terraform state file Create a managed identity which has contributor permissions on this storage account If not already the case, install the Terraform extension for your Azure DevOps Org Create a new Azure DevOps Project Create a service connection to the &ldquo;backend tenant&rdquo; using workload identity federation with your previously created managed identity Create a managed identity in the customer tenant where you finally want to deploy Azure Resources using Terraform, with Contributor permission on the Subscription Create a service connection to the customer tenant using workload identity federation with your previously created managed identity Create a repository with basic Terraform files Create an Azure DevOps Pipeline Preview Prepare &ldquo;Backend Tenant&rdquo; to store Terraform State File As outlined in this example, I intend to store the Terraform state file in a different Azure Tenant than where the actual Azure Deployment will occur."><meta property="og:type" content="article"><meta property="og:url" content="https://nasan92.github.io/posts/2023-09-23-azuredevopsterraform/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-23T06:10:21+01:00"><meta property="article:modified_time" content="2023-09-23T06:10:21+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="(1/2) Setting up Azure workload identity federation with Terraform in Azure DevOps pipelines (2 Part Series)"><meta name=twitter:description content="I was curious about how to set up Azure DevOps to utilize Terraform for deploying Azure resources with workload identity federation instead of relying on a service principal with secrets. In this blog post, I will demonstrate how I set up this configuration.
To learn more about workload identity federation read the docs:
Workload identity federation - Microsoft Entra | Microsoft Learn
Prerequisites Azure DevOps Org &ldquo;Customer Azure Tenant&rdquo; with Subscription &ldquo;Backend Azure Tenant&rdquo; with Subscription (can be in the same tenant - in our example we use different tenants) Azure Powershell Module Overview - Setup Steps Create a storage account that will store the Terraform state file Create a managed identity which has contributor permissions on this storage account If not already the case, install the Terraform extension for your Azure DevOps Org Create a new Azure DevOps Project Create a service connection to the &ldquo;backend tenant&rdquo; using workload identity federation with your previously created managed identity Create a managed identity in the customer tenant where you finally want to deploy Azure Resources using Terraform, with Contributor permission on the Subscription Create a service connection to the customer tenant using workload identity federation with your previously created managed identity Create a repository with basic Terraform files Create an Azure DevOps Pipeline Preview Prepare &ldquo;Backend Tenant&rdquo; to store Terraform State File As outlined in this example, I intend to store the Terraform state file in a different Azure Tenant than where the actual Azure Deployment will occur."><meta name=application-name content="NASAN"><meta name=apple-mobile-web-app-title content="NASAN"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://nasan92.github.io/posts/2023-09-23-azuredevopsterraform/><link rel=prev href=https://nasan92.github.io/posts/2023-09-15-steallikeanartist/><link rel=next href=https://nasan92.github.io/posts/2023-09-27-terraform-locally/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"(1/2) Setting up Azure workload identity federation with Terraform in Azure DevOps pipelines (2 Part Series)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/nasan92.github.io\/posts\/2023-09-23-azuredevopsterraform\/"},"genre":"posts","keywords":"terraform, AzureDevOps, Microsoft, WorkloadIdentityFederation, MicrosoftEntra, InfrastructureAsCode","wordcount":1677,"url":"https:\/\/nasan92.github.io\/posts\/2023-09-23-azuredevopsterraform\/","datePublished":"2023-09-23T06:10:21+01:00","dateModified":"2023-09-23T06:10:21+01:00","publisher":{"@type":"Organization","name":"Nathanael Santschi"},"author":{"@type":"Person","name":"Nathanael Santschi"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":""==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:""==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=NASAN>NASAN</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://www.youtube.com/channel/UCD152s9TkCpwTFTTXzdjvCw rel="noopener noreffer" target=_blank>Youtube </a><a class=menu-item href=/mindmaps/mindmaps>MindMaps </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=NASAN>NASAN</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://www.youtube.com/channel/UCD152s9TkCpwTFTTXzdjvCw title rel="noopener noreffer" target=_blank>Youtube</a><a class=menu-item href=/mindmaps/mindmaps title>MindMaps</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">(1/2) Setting up Azure workload identity federation with Terraform in Azure DevOps pipelines (2 Part Series)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Nathanael Santschi</a></span>&nbsp;<span class=post-category>included in <a href=/categories/azure/><i class="far fa-folder fa-fw"></i>Azure</a>&nbsp;<a href=/categories/azuredevops/><i class="far fa-folder fa-fw"></i>AzureDevOps</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-09-23>2023-09-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1677 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#overview---setup-steps>Overview - Setup Steps</a></li><li><a href=#prepare-backend-tenant-to-store-terraform-state-file>Prepare &ldquo;Backend Tenant&rdquo; to store Terraform State File</a><ul><li><a href=#1-create-a-storage-account-with-powershell>1. Create a Storage Account with Powershell</a></li><li><a href=#2-create-a-managed-identity-to-enable-access-to-the-state-file-from-the-pipeline-via-workload-identity-federation>2. Create a managed identity to enable access to the state file from the pipeline via workload identity federation</a></li></ul></li><li><a href=#prepare-azure-devops>Prepare Azure DevOps</a><ul><li><a href=#3-install-terraform-extension>3. Install Terraform Extension</a></li><li><a href=#4-create-new-azure-devops-project>4. Create new Azure DevOps Project</a></li><li><a href=#5-create-a-service-connection-to-the-backend-tenant-where-the-terraform-state-file-will-be-stored>5. Create a Service Connection to the &ldquo;backend Tenant&rdquo; where the terraform state file will be stored</a></li></ul></li><li><a href=#prepare-customer-tenant-where-we-want-to-deploy-azure-resources-with-terraform>Prepare Customer Tenant where we want to deploy Azure Resources with Terraform</a><ul><li><a href=#6-create-managed-identity>6. Create Managed Identity</a></li></ul></li><li><a href=#azure-devops-create-customer-connection--repo-and-pipeline>Azure DevOps: Create Customer Connection + Repo and Pipeline</a><ul><li><a href=#7-create-a-service-connection-to-the-customer-tenant>7. Create a Service Connection to the &ldquo;Customer Tenant&rdquo;</a></li><li><a href=#8-create-a-new-repository>8. Create a new Repository</a></li><li><a href=#91-create-a-plan-and-approval-environment>9.1 Create a Plan and Approval Environment</a></li><li><a href=#92-prepare-pipeline-file>9.2 Prepare Pipeline file</a></li><li><a href=#93-create-the-pipeline>9.3 Create the Pipeline</a></li></ul></li><li><a href=#what-about-running-terraform-locally>what about running terraform locally?</a></li></ul></nav></div></div><div class=content id=content><p>I was curious about how to set up Azure DevOps to utilize Terraform for deploying Azure resources with <strong>workload identity federation</strong> instead of relying on a <strong>service principal</strong> with secrets. In this blog post, I will demonstrate how I set up this configuration.</p><p>To learn more about workload identity federation read the docs:<br><a href=https://learn.microsoft.com/en-us/azure/active-directory/workload-identities/workload-identity-federation target=_blank rel="noopener noreffer">Workload identity federation - Microsoft Entra | Microsoft Learn</a></p><h2 id=prerequisites>Prerequisites</h2><ul><li>Azure DevOps Org</li><li><strong>&ldquo;Customer Azure Tenant&rdquo;</strong> with Subscription</li><li><strong>&ldquo;Backend Azure Tenant&rdquo;</strong> with Subscription (can be in the same tenant - in our example we use different tenants)</li><li><a href=https://learn.microsoft.com/en-us/powershell/azure/ target=_blank rel="noopener noreffer">Azure Powershell Module</a></li></ul><h2 id=overview---setup-steps>Overview - Setup Steps</h2><ol><li>Create a <strong>storage account</strong> that will store the Terraform state file</li><li>Create a <strong>managed identity</strong> which has contributor permissions on this storage account</li><li>If not already the case, install the <strong>Terraform extension</strong> for your Azure DevOps Org</li><li>Create a new <strong>Azure DevOps Project</strong></li><li>Create a <strong>service connection</strong> to the &ldquo;backend tenant&rdquo; using workload identity federation with your previously created managed identity</li><li>Create a <strong>managed identity</strong> in the customer tenant where you finally want to deploy Azure Resources using Terraform, with Contributor permission on the Subscription</li><li>Create a <strong>service connection</strong> to the customer tenant using workload identity federation with your previously created managed identity</li><li>Create a <strong>repository</strong> with basic Terraform files</li><li>Create an <strong>Azure DevOps Pipeline</strong></li></ol><p><figure><a class=lightgallery href=/images/terraform-overview-Demo1.png title=image data-thumbnail=/images/terraform-overview-Demo1.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/terraform-overview-Demo1.png data-srcset="/images/terraform-overview-Demo1.png, /images/terraform-overview-Demo1.png 1.5x, /images/terraform-overview-Demo1.png 2x" data-sizes=auto alt=/images/terraform-overview-Demo1.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h2 id=prepare-backend-tenant-to-store-terraform-state-file>Prepare &ldquo;Backend Tenant&rdquo; to store Terraform State File</h2><p>As outlined in this example, I intend to store the Terraform state file in a different Azure Tenant than where the actual Azure Deployment will occur.</p><h3 id=1-create-a-storage-account-with-powershell>1. Create a Storage Account with Powershell</h3><p>Run the following script in the Backend Tenant.<br>This will create:</p><ul><li>ResourceGroup</li><li>StorageAccount</li><li>Container</li></ul><p>Our terraform state file will later be stored in this container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Connect with the &#34;Backend tenant&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>connect-azaccount</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Define variables</span>
</span></span><span class=line><span class=cl><span class=nv>$subscriptionName</span> <span class=p>=</span> <span class=s2>&#34;SUB-TerraformBackend&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$resourceGroupName</span> <span class=p>=</span> <span class=s2>&#34;rg-terraform-backend-demo&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$location</span> <span class=p>=</span> <span class=s2>&#34;switzerlandnorth&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$storageAccountName</span> <span class=p>=</span> <span class=s2>&#34;tfdemo23092314462014&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$containerName</span> <span class=p>=</span> <span class=s2>&#34;terraform01&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set Azure Subscription</span>
</span></span><span class=line><span class=cl><span class=nb>Set-AzContext</span> <span class=n>-SubscriptionName</span> <span class=nv>$subscriptionName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create resource group</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzResourceGroup</span> <span class=n>-Name</span> <span class=nv>$resourceGroupName</span> <span class=n>-Location</span> <span class=nv>$location</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create storage account</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzStorageAccount</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-Name</span> <span class=nv>$storageAccountName</span> <span class=n>-Location</span> <span class=nv>$location</span> <span class=n>-SkuName</span> <span class=n>Standard_LRS</span> <span class=n>-Kind</span> <span class=n>StorageV2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create blob container</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzStorageContainer</span> <span class=n>-Name</span> <span class=nv>$containerName</span> <span class=n>-Context</span> <span class=p>(</span><span class=nb>Get-AzStorageAccount</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-Name</span> <span class=nv>$storageAccountName</span><span class=p>).</span><span class=py>Context</span>
</span></span></code></pre></div><h3 id=2-create-a-managed-identity-to-enable-access-to-the-state-file-from-the-pipeline-via-workload-identity-federation>2. Create a managed identity to enable access to the state file from the pipeline via workload identity federation</h3><p>Official MS docs:<br><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/release/configure-workload-identity?view=azure-devops" target=_blank rel="noopener noreffer">Manually configure Azure Resource Manager workload identity service connections - Azure Pipelines | Microsoft Learn</a></p><p>Create the managed identity using Powershell and grant the required permissions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Connect with the &#34;Backend tenant&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>connect-azaccount</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Define variables</span>
</span></span><span class=line><span class=cl><span class=nv>$subscriptionName</span> <span class=p>=</span> <span class=s2>&#34;SUB-TerraformBackend&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$resourceGroupName</span> <span class=p>=</span> <span class=s2>&#34;rg-terraform-backend-demo-identity&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$location</span> <span class=p>=</span> <span class=s2>&#34;switzerlandnorth&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$UserAssignedIDName</span> <span class=p>=</span> <span class=s2>&#34;IDtfdemo2309231446&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$credentialName</span> <span class=p>=</span> <span class=s2>&#34;azdevops-backend&#34;</span>
</span></span><span class=line><span class=cl><span class=c># Managed Identity will be granted Contributor Role to this RSG</span>
</span></span><span class=line><span class=cl><span class=nv>$TFBackendRSGname</span> <span class=p>=</span> <span class=s2>&#34;rg-terraform-backend-demo&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set Azure Subscription</span>
</span></span><span class=line><span class=cl><span class=nb>Set-AzContext</span> <span class=n>-SubscriptionName</span> <span class=nv>$subscriptionName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create resource group</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzResourceGroup</span> <span class=n>-Name</span> <span class=nv>$resourceGroupName</span> <span class=n>-Location</span> <span class=nv>$location</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create User assigned identity</span>
</span></span><span class=line><span class=cl><span class=nv>$NewIdentity</span> <span class=p>=</span> <span class=nb>New-AzUserAssignedIdentity</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-Location</span> <span class=nv>$location</span> <span class=n>-Name</span> <span class=nv>$UserAssignedIDName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># create federated credential</span>
</span></span><span class=line><span class=cl><span class=c># Note: the Issuer + SubjectIdentifier will be changed later!</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzFederatedIdentityCredentials</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-IdentityName</span> <span class=nv>$UserAssignedIDName</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>    <span class=n>-Name</span> <span class=nv>$credentialName</span> <span class=n>-Issuer</span> <span class=s2>&#34;https://app.vstoken.visualstudio.com/&lt;unique-identifier&gt;&#34;</span> <span class=n>-Subject</span> <span class=s2>&#34;sc://&lt;Azure DevOps organization&gt;/&lt;Project name&gt;/&lt;Service Connection name&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Assign permission to the managed identity</span>
</span></span><span class=line><span class=cl><span class=nv>$TFRSGScope</span> <span class=p>=</span> <span class=p>(</span><span class=nb>get-azresourcegroup</span> <span class=n>-Name</span> <span class=nv>$TFBackendRSGname</span><span class=p>).</span><span class=py>ResourceId</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>New-AzRoleAssignment</span> <span class=n>-RoleDefinitionName</span> <span class=n>Contributor</span> <span class=n>-Scope</span> <span class=nv>$TFRSGScope</span> <span class=n>-ObjectId</span> <span class=nv>$NewIdentity</span><span class=p>.</span><span class=py>PrincipalId</span>
</span></span></code></pre></div><h2 id=prepare-azure-devops>Prepare Azure DevOps</h2><h3 id=3-install-terraform-extension>3. Install Terraform Extension</h3><p>You will need this extension later in the pipeline:
<a href="https://marketplace.visualstudio.com/items?itemName=ms-devlabs.custom-terraform-tasks" target=_blank rel="noopener noreffer">Terraform - Visual Studio Marketplace</a><figure><a class=lightgallery href=/images/Pastedimage20230920075015.png title=image data-thumbnail=/images/Pastedimage20230920075015.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/Pastedimage20230920075015.png data-srcset="/images/Pastedimage20230920075015.png, /images/Pastedimage20230920075015.png 1.5x, /images/Pastedimage20230920075015.png 2x" data-sizes=auto alt=/images/Pastedimage20230920075015.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230920075040.png title=image data-thumbnail=/images/20230920075040.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230920075040.png data-srcset="/images/20230920075040.png, /images/20230920075040.png 1.5x, /images/20230920075040.png 2x" data-sizes=auto alt=/images/20230920075040.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h3 id=4-create-new-azure-devops-project>4. Create new Azure DevOps Project</h3><p><figure><a class=lightgallery href=/images/20230923201942.png title=image data-thumbnail=/images/20230923201942.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923201942.png data-srcset="/images/20230923201942.png, /images/20230923201942.png 1.5x, /images/20230923201942.png 2x" data-sizes=auto alt=/images/20230923201942.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h3 id=5-create-a-service-connection-to-the-backend-tenant-where-the-terraform-state-file-will-be-stored>5. Create a Service Connection to the &ldquo;backend Tenant&rdquo; where the terraform state file will be stored</h3><p>MS Docs: <a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/release/configure-workload-identity?view=azure-devops#create-service-connection" target=_blank rel="noopener noreffer">Manually configure Azure Resource Manager workload identity service connections - Azure Pipelines | Microsoft Learn</a></p><p><figure><a class=lightgallery href=/images/20230923202749.png title=image data-thumbnail=/images/20230923202749.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923202749.png data-srcset="/images/20230923202749.png, /images/20230923202749.png 1.5x, /images/20230923202749.png 2x" data-sizes=auto alt=/images/20230923202749.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923202812.png title=image data-thumbnail=/images/20230923202812.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923202812.png data-srcset="/images/20230923202812.png, /images/20230923202812.png 1.5x, /images/20230923202812.png 2x" data-sizes=auto alt=/images/20230923202812.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>In earlier days we didn&rsquo;t had the option of Workload Identity federation which we select now:</p><p><figure><a class=lightgallery href=/images/20230923202930.png title=image data-thumbnail=/images/20230923202930.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923202930.png data-srcset="/images/20230923202930.png, /images/20230923202930.png 1.5x, /images/20230923202930.png 2x" data-sizes=auto alt=/images/20230923202930.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923203008.png title=image data-thumbnail=/images/20230923203008.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923203008.png data-srcset="/images/20230923203008.png, /images/20230923203008.png 1.5x, /images/20230923203008.png 2x" data-sizes=auto alt=/images/20230923203008.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>now you need to copy first the <strong>issuer</strong> and later the <strong>subject Identifier</strong> from here:</p><p><figure><a class=lightgallery href=/images/20230923203124-2.png title=image data-thumbnail=/images/20230923203124-2.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923203124-2.png data-srcset="/images/20230923203124-2.png, /images/20230923203124-2.png 1.5x, /images/20230923203124-2.png 2x" data-sizes=auto alt=/images/20230923203124-2.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>And switch to the managed identity that we created earlier to add those values to the federated credential:</p><p><figure><a class=lightgallery href=/images/20230923203306-2.png title=image data-thumbnail=/images/20230923203306-2.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923203306-2.png data-srcset="/images/20230923203306-2.png, /images/20230923203306-2.png 1.5x, /images/20230923203306-2.png 2x" data-sizes=auto alt=/images/20230923203306-2.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>Update the federated credential.</p><p>Back in the Azure DevOps service connection window, you need to provide:</p><ul><li>Subscription ID/Name -> the same subscription we used at the beginning to create the backend storage account for the Terraform state file</li><li>Service Principal Id -> Client Id of the managed identity</li><li>Tenant Id: from the tenant where the above subscription is located</li></ul><p><figure><a class=lightgallery href=/images/20230923203548.png title=image data-thumbnail=/images/20230923203548.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923203548.png data-srcset="/images/20230923203548.png, /images/20230923203548.png 1.5x, /images/20230923203548.png 2x" data-sizes=auto alt=/images/20230923203548.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>Then verify and save, and you can see a new service connection:</p><p><figure><a class=lightgallery href=/images/20230923204010.png title=image data-thumbnail=/images/20230923204010.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923204010.png data-srcset="/images/20230923204010.png, /images/20230923204010.png 1.5x, /images/20230923204010.png 2x" data-sizes=auto alt=/images/20230923204010.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h2 id=prepare-customer-tenant-where-we-want-to-deploy-azure-resources-with-terraform>Prepare Customer Tenant where we want to deploy Azure Resources with Terraform</h2><h3 id=6-create-managed-identity>6. Create Managed Identity</h3><p>To gain access to this tenant, we also need to create a managed identity with permissions at the desired scope.<br>In this example, we grant the managed identity the Contributor role on the Subscription.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Connect with the &#34;Backend tenant&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>connect-azaccount</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Define variables</span>
</span></span><span class=line><span class=cl><span class=nv>$subscriptionName</span> <span class=p>=</span> <span class=s2>&#34;SUB-Terraformdemo-01&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$resourceGroupName</span> <span class=p>=</span> <span class=s2>&#34;rg-terraform-demo-identity&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$location</span> <span class=p>=</span> <span class=s2>&#34;switzerlandnorth&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$UserAssignedIDName</span> <span class=p>=</span> <span class=s2>&#34;IDtfdemo2309231447&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$credentialName</span> <span class=p>=</span> <span class=s2>&#34;azdevops-backend&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set Azure Subscription</span>
</span></span><span class=line><span class=cl><span class=nb>Set-AzContext</span> <span class=n>-SubscriptionName</span> <span class=nv>$subscriptionName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create resource group</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzResourceGroup</span> <span class=n>-Name</span> <span class=nv>$resourceGroupName</span> <span class=n>-Location</span> <span class=nv>$location</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create User assigned identity</span>
</span></span><span class=line><span class=cl><span class=nv>$NewIdentity</span> <span class=p>=</span> <span class=nb>New-AzUserAssignedIdentity</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-Location</span> <span class=nv>$location</span> <span class=n>-Name</span> <span class=nv>$UserAssignedIDName</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># create federated credential</span>
</span></span><span class=line><span class=cl><span class=c># Note: the Issuer + SubjectIdentifier will be changed later!</span>
</span></span><span class=line><span class=cl><span class=nb>New-AzFederatedIdentityCredentials</span> <span class=n>-ResourceGroupName</span> <span class=nv>$resourceGroupName</span> <span class=n>-IdentityName</span> <span class=nv>$UserAssignedIDName</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>    <span class=n>-Name</span> <span class=nv>$credentialName</span> <span class=n>-Issuer</span> <span class=s2>&#34;https://app.vstoken.visualstudio.com/&lt;unique-identifier&gt;&#34;</span> <span class=n>-Subject</span> <span class=s2>&#34;sc://&lt;Azure DevOps organization&gt;/&lt;Project name&gt;/&lt;Service Connection name&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Assign permission to the managed identity</span>
</span></span><span class=line><span class=cl><span class=nv>$SubscriptionId</span> <span class=p>=</span> <span class=p>(</span><span class=nb>get-azsubscription</span> <span class=n>-SubscriptionName</span> <span class=nv>$subscriptionName</span><span class=p>).</span><span class=py>Id</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>New-AzRoleAssignment</span> <span class=n>-RoleDefinitionName</span> <span class=n>Contributor</span> <span class=n>-Scope</span> <span class=s2>&#34;/subscriptions/</span><span class=nv>$SubscriptionId</span><span class=s2>&#34;</span> <span class=n>-ObjectId</span> <span class=nv>$NewIdentity</span><span class=p>.</span><span class=py>PrincipalId</span>
</span></span></code></pre></div><h2 id=azure-devops-create-customer-connection--repo-and-pipeline>Azure DevOps: Create Customer Connection + Repo and Pipeline</h2><h3 id=7-create-a-service-connection-to-the-customer-tenant>7. Create a Service Connection to the &ldquo;Customer Tenant&rdquo;</h3><p>Now, let&rsquo;s proceed to create a second Service Connection:</p><p><figure><a class=lightgallery href=/images/20230923205704.png title=image data-thumbnail=/images/20230923205704.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923205704.png data-srcset="/images/20230923205704.png, /images/20230923205704.png 1.5x, /images/20230923205704.png 2x" data-sizes=auto alt=/images/20230923205704.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923205727.png title=image data-thumbnail=/images/20230923205727.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923205727.png data-srcset="/images/20230923205727.png, /images/20230923205727.png 1.5x, /images/20230923205727.png 2x" data-sizes=auto alt=/images/20230923205727.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923205846.png title=image data-thumbnail=/images/20230923205846.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923205846.png data-srcset="/images/20230923205846.png, /images/20230923205846.png 1.5x, /images/20230923205846.png 2x" data-sizes=auto alt=/images/20230923205846.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>In this step, you&rsquo;ll also need to copy the issuer and subject identifier as shown below:<figure><a class=lightgallery href=/images/20230923203124-2.png title=image data-thumbnail=/images/20230923203124-2.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923203124-2.png data-srcset="/images/20230923203124-2.png, /images/20230923203124-2.png 1.5x, /images/20230923203124-2.png 2x" data-sizes=auto alt=/images/20230923203124-2.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>Next, add these copied values to the federated credential of the managed identity in the &ldquo;customer tenant&rdquo;:<figure><a class=lightgallery href=/images/20230923210124-2.png title=image data-thumbnail=/images/20230923210124-2.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923210124-2.png data-srcset="/images/20230923210124-2.png, /images/20230923210124-2.png 1.5x, /images/20230923210124-2.png 2x" data-sizes=auto alt=/images/20230923210124-2.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>Now, return to the Azure DevOps Wizard and enter the necessary information for the customer tenant.<br>Specifically, set the Service Principal Id to the Client Id of the managed identity:<figure><a class=lightgallery href=/images/20230923210224.png title=image data-thumbnail=/images/20230923210224.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923210224.png data-srcset="/images/20230923210224.png, /images/20230923210224.png 1.5x, /images/20230923210224.png 2x" data-sizes=auto alt=/images/20230923210224.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>After verifying the settings, save the configuration, and you&rsquo;ll now have two service connections:<figure><a class=lightgallery href=/images/20230923210441.png title=image data-thumbnail=/images/20230923210441.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923210441.png data-srcset="/images/20230923210441.png, /images/20230923210441.png 1.5x, /images/20230923210441.png 2x" data-sizes=auto alt=/images/20230923210441.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h3 id=8-create-a-new-repository>8. Create a new Repository</h3><p>Now, let&rsquo;s create a new repository where we will store our Terraform code and the pipeline file:</p><p><figure><a class=lightgallery href=/images/20230923210950.png title=image data-thumbnail=/images/20230923210950.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923210950.png data-srcset="/images/20230923210950.png, /images/20230923210950.png 1.5x, /images/20230923210950.png 2x" data-sizes=auto alt=/images/20230923210950.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>After creating the repository, you can clone it, for example, into Visual Studio Code (VSCode).</p><h4 id=prepare-directory--terraform-files-in-repo>Prepare Directory + terraform files in Repo</h4><p>We will organize the repository with the following directory structure:</p><pre tabindex=0><code>Terraform-Demo  
└── terraform  
    ├── 00_provider.tf  
    ├── 01_mainexample.tf  
└── azure-pipeline.yaml  
</code></pre><p>Note: In the provider file we add an empty backend. The values for the backend storage account will be provided in the pipeline.<br>00_provider tf:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>terraform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>backend</span> <span class=s2>&#34;azurerm&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>required_version</span> = <span class=s2>&#34;1.4.0&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>provider</span> <span class=s2>&#34;azurerm&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>alias</span>           = <span class=s2>&#34;platform&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nx>features</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The only thing we want to create for now is an empty resource group:<br>01_mainexample tf</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;azurerm_resource_group&#34;</span> <span class=s2>&#34;demo&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kr>  provider</span> <span class=o>=</span> <span class=nx>azurerm</span><span class=p>.</span><span class=nx>platform</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>     = <span class=s2>&#34;rsg-demo&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>location</span> = <span class=s2>&#34;Switzerlandnorth&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=91-create-a-plan-and-approval-environment>9.1 Create a Plan and Approval Environment</h3><p>To enable reviewing the Terraform plan and approving it for execution, we&rsquo;ll set up an approval environment:</p><ul><li>Navigate to Pipelines, Environment</li><li>Click <strong>&ldquo;New Environment&rdquo;</strong> and create new environment variables for:<ul><li>terraform plan</li><li>terraform apply</li></ul></li></ul><p>for the terraform apply add an approval check:</p><p><figure><a class=lightgallery href=/images/20230923213049.png title=image data-thumbnail=/images/20230923213049.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923213049.png data-srcset="/images/20230923213049.png, /images/20230923213049.png 1.5x, /images/20230923213049.png 2x" data-sizes=auto alt=/images/20230923213049.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923213336.png title=image data-thumbnail=/images/20230923213336.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923213336.png data-srcset="/images/20230923213336.png, /images/20230923213336.png 1.5x, /images/20230923213336.png 2x" data-sizes=auto alt=/images/20230923213336.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h3 id=92-prepare-pipeline-file>9.2 Prepare Pipeline file</h3><p>Important are the variables:</p><ul><li>customer_repo_name: Name of the repository where Terraform Code is stored</li><li>backendServiceArm: Name of the Service Connection to the &ldquo;Backend Tenant&rdquo; where terraform state will be stored</li><li>backendAzureRmResourceGroupName: Resource Group Name of Terraform State File</li><li>backendAzureRmStorageAccountName: Storage Account Name of Terraform State File</li><li>backendAzureRmContainerName: Storage Account Container Name of Terraform State File</li><li>backendAzureRmKey: Name of the Terraform State File</li><li>environmentServiceNameAzureRM: Name of the Service Connection to the &ldquo;customer tenant&rdquo;</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>pool</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Azure Pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>vmImage</span><span class=p>:</span><span class=w> </span><span class=l>windows-2019</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>terraform_version</span><span class=p>:</span><span class=w> </span><span class=m>1.4.0</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>customer_repo_name</span><span class=p>:</span><span class=w> </span><span class=l>Terraform-Demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backendServiceArm</span><span class=p>:</span><span class=w> </span><span class=l>TerraformBackend-Statefile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backendAzureRmResourceGroupName</span><span class=p>:</span><span class=w> </span><span class=l>rg-terraform-backend-demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backendAzureRmStorageAccountName</span><span class=p>:</span><span class=w> </span><span class=l>tfdemo23092314462014</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backendAzureRmContainerName</span><span class=p>:</span><span class=w> </span><span class=l>terraform01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>backendAzureRmKey</span><span class=p>:</span><span class=w> </span><span class=l>terraform.tfstate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environmentServiceNameAzureRM</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;DemoCustomer-DemoSubscription&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># STAGE COPY ######################################################################################################################################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>copy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job</span><span class=p>:</span><span class=w> </span><span class=l>updaterepo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Update standard repo with customer code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>timeoutInMinutes</span><span class=p>:</span><span class=w> </span><span class=m>120</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>CopyFiles@2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Copy Files to: $(build.artifactstagingdirectory)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>SourceFolder</span><span class=p>:</span><span class=w> </span><span class=l>terraform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>TargetFolder</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$(build.artifactstagingdirectory)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>PublishBuildArtifacts@1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>displayName: &#39;Publish Artifact</span><span class=p>:</span><span class=w> </span><span class=l>drop\terraform&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>PathtoPublish</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$(build.artifactstagingdirectory)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>ArtifactName</span><span class=p>:</span><span class=w> </span><span class=l>terraform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># STAGE PLAN #######################################################################################################################################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>deployment</span><span class=p>:</span><span class=w> </span><span class=l>plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition: eq(1,1) # only run this job if condition is equal, example</span><span class=p>:</span><span class=w> </span><span class=l>eq(1,1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Terraform plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>timeoutInMinutes</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>continueOnError</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>Terraform plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>runOnce</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>download</span><span class=p>:</span><span class=w> </span><span class=l>current</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>artifact</span><span class=p>:</span><span class=w> </span><span class=l>terraform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Download Repo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Terraform Version: ${{variables.terraform_version}}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>terraformVersion</span><span class=p>:</span><span class=w> </span><span class=l>${{variables.terraform_version}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>TerraformTaskV4@4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;terraform init&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;azurerm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;init&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendServiceArm</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendServiceArm }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmResourceGroupName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmResourceGroupName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmStorageAccountName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmStorageAccountName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmContainerName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmContainerName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmKey</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmKey }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>environmentServiceNameAzureRM</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.environmentServiceNameAzureRM }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>workingDirectory</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$(Agent.BuildDirectory)\Terraform&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>TerraformTaskV4@4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;terraform plan&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;azurerm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;plan&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>environmentServiceNameAzureRM</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.environmentServiceNameAzureRM }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>workingDirectory</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$(Agent.BuildDirectory)\Terraform&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>commandOptions</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;-input=false -out=$(Agent.BuildDirectory)\plan&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>PublishBuildArtifacts@1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>pathToPublish</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$(Agent.BuildDirectory)\plan&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>artifactName</span><span class=p>:</span><span class=w> </span><span class=l>plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=c># STAGE APPLY #######################################################################################################################################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>tfapply</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>deployment</span><span class=p>:</span><span class=w> </span><span class=l>dpapply</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition: eq(1,1) # only run this job if condition is equal, example</span><span class=p>:</span><span class=w> </span><span class=l>eq(1,1)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Terraform apply</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>timeoutInMinutes</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>Terraform apply</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>runOnce</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>download</span><span class=p>:</span><span class=w> </span><span class=l>current</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>artifact</span><span class=p>:</span><span class=w> </span><span class=l>terraform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Download Merged Repo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>download</span><span class=p>:</span><span class=w> </span><span class=l>current</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>artifact</span><span class=p>:</span><span class=w> </span><span class=l>plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=l>Download plan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>ms-devlabs.custom-terraform-tasks.custom-terraform-installer-task.TerraformInstaller@0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c>#- task: TerraformInstaller@0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Terraform Version: ${{variables.terraform_version}}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>terraformVersion</span><span class=p>:</span><span class=w> </span><span class=l>${{variables.terraform_version}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>TerraformTaskV4@4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;terraform init&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;azurerm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;init&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendServiceArm</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendServiceArm }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmResourceGroupName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmResourceGroupName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmStorageAccountName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmStorageAccountName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmContainerName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmContainerName }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>backendAzureRmKey</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.backendAzureRmKey }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>environmentServiceNameAzureRM</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.environmentServiceNameAzureRM }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>workingDirectory</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$(Agent.BuildDirectory)\Terraform&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>task</span><span class=p>:</span><span class=w> </span><span class=l>TerraformTaskV4@4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>displayName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;terraform apply&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;azurerm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;apply&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>environmentServiceNameAzureRM</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ variables.environmentServiceNameAzureRM }}&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>workingDirectory</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$(Agent.BuildDirectory)\Terraform&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nt>commandOptions</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;-input=false -no-color $(Agent.BuildDirectory)\plan\plan&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span></code></pre></div><h3 id=93-create-the-pipeline>9.3 Create the Pipeline</h3><p><figure><a class=lightgallery href=/images/20230923214119.png title=image data-thumbnail=/images/20230923214119.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923214119.png data-srcset="/images/20230923214119.png, /images/20230923214119.png 1.5x, /images/20230923214119.png 2x" data-sizes=auto alt=/images/20230923214119.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p><figure><a class=lightgallery href=/images/20230923214137.png title=image data-thumbnail=/images/20230923214137.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923214137.png data-srcset="/images/20230923214137.png, /images/20230923214137.png 1.5x, /images/20230923214137.png 2x" data-sizes=auto alt=/images/20230923214137.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>select repo and pipeline file - and run<figure><a class=lightgallery href=/images/20230923214211.png title=image data-thumbnail=/images/20230923214211.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923214211.png data-srcset="/images/20230923214211.png, /images/20230923214211.png 1.5x, /images/20230923214211.png 2x" data-sizes=auto alt=/images/20230923214211.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>note: first time you run the pipeline you need to permit access to environments and so on.</p><p>you can look up the terraform plan</p><p><figure><a class=lightgallery href=/images/20230923220002.png title=image data-thumbnail=/images/20230923220002.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923220002.png data-srcset="/images/20230923220002.png, /images/20230923220002.png 1.5x, /images/20230923220002.png 2x" data-sizes=auto alt=/images/20230923220002.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>If you want to approve it to run terraform apply you can do that:</p><p><figure><a class=lightgallery href=/images/20230923220105.png title=image data-thumbnail=/images/20230923220105.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923220105.png data-srcset="/images/20230923220105.png, /images/20230923220105.png 1.5x, /images/20230923220105.png 2x" data-sizes=auto alt=/images/20230923220105.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><p>and now terraform can successfuly create my declared empty resource group:<figure><a class=lightgallery href=/images/20230923221425.png title=image data-thumbnail=/images/20230923221425.png data-sub-html="<h2>Preview</h2><p>image</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/20230923221425.png data-srcset="/images/20230923221425.png, /images/20230923221425.png 1.5x, /images/20230923221425.png 2x" data-sizes=auto alt=/images/20230923221425.png></a><figcaption class=image-caption>Preview</figcaption></figure></p><h2 id=what-about-running-terraform-locally>what about running terraform locally?</h2><p>Because we are using a managed identity and not a service principal with a secret that has a certain lifetime we are not directly able to run terraform from the local Machine.
In <a href=https://nasan.ch/posts/2023-09-27-Terraform-locally.md/ target=_blank rel="noopener noreffer">Part 2</a> I will show you a possible solution for using terraform locally if necessary.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-09-23</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/terraform/>terraform</a>,&nbsp;<a href=/tags/azuredevops/>AzureDevOps</a>,&nbsp;<a href=/tags/microsoft/>Microsoft</a>,&nbsp;<a href=/tags/workloadidentityfederation/>WorkloadIdentityFederation</a>,&nbsp;<a href=/tags/microsoftentra/>MicrosoftEntra</a>,&nbsp;<a href=/tags/infrastructureascode/>InfrastructureAsCode</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2023-09-15-steallikeanartist/ class=prev rel=prev title="Steal like an Artist - MindMap"><i class="fas fa-angle-left fa-fw"></i>Steal like an Artist - MindMap</a>
<a href=/posts/2023-09-27-terraform-locally/ class=next rel=next title="(2/2) How to use terraform from local Machine additionally to Azure DevOps Pipeline (2 Part Series)">(2/2) How to use terraform from local Machine additionally to Azure DevOps Pipeline (2 Part Series)<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Nathanael Santschi Blog</div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.119.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},search:{highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>